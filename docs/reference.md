# リファレンス

OpsScriptMD 独自の要素について解説します。

## スクリプトオプション

Markdown のコードブロックを実行するための構成定義です。

### Example

```js
{cmd: ["bash"], encoding: "utf-8", stdin: true}
```

### `cmd`

コードブロックのスクリプトを解釈・実行するインタプリタを指定します。

`stdin` オプションを指定しない場合、スクリプトは `cmd` の末尾の引数としてインタプリタへ渡されます。

### `stdin`

(default: `false`)

`stdin: true` を指定すると、スクリプトは引数ではなく、標準入力からインタプリタへ渡されるようになります。

### `encoding` 

(default: `utf-8`)

インタプリタへ入力するスクリプトと、インタプリタの標準出力をエンコードする文字コードを定義します。

## 構成定義

手順書が配置されているディレクトリか、それよりも上位のディレクトリに `opsscript.yml` という名前のファイルが配置されている場合は、構成定義として読み込まれます。

対象となるディレクトリの階層に `opsscript.yml` が複数存在する場合は、手順書と最も近い階層にあるファイルのみが読み込まれます。

読み込まれた `opsscript.yml` と同じディレクトリに、`opsscript-*.yml` にマッチするファイル名を持つファイルが存在する場合は、`opsscript.yml` よりも優先して定義された値が読み込まれます。

`opsscript-*.yml` にマッチするファイルが複数ある場合は、優先順位付けができないため読み込まれず `opsscript.yml` の定義のみが有効になります。

### Example

```yaml
environment:
    PATH: /bin:/usr/bin

variables:
    db_server: 192.168.0.1
    ap_server: 192.168.0.2
```

### `environment`

OpsView から実行されるスクリプトに設定したい環境変数を定義できます。

### `variables`

手順書に埋め込みたい変数を定義できます。

手順書からは `{{...}}` という形式で変数を参照できます。

## コンテキスト定数

コンテキスト定数とは、実行環境の状況により解決される固定値のことで、手順書と構成定義の両方から参照できます。

ただし、それぞれで参照するための構文が異なるため注意してください。

### 手順書から参照する

構成定義の `variables` を参照するのと同様に `{{...}}` 形式で参照できます。

```
{{BASE_PATH}}
```

### 構成定義から参照する

構成定義では `${...}` 形式で参照できます。

```yaml
environment:
    PATH: ${BASE_PATH}/bin
```

### `BASE_PATH`

`opsscript.yml` が配置されている場合は、そのファイルが存在するディレクトリのパスが `BASE_PATH` になります。`opsscript.yml` が配置されていない場合は、手順書が配置されたディレクトリのパスが `BASE_PATH` になります。
